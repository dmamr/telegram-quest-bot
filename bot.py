from telegram import Update
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, ContextTypes, filters

# –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω –æ—Ç BotFather
TOKEN = '7238885317:AAFfJ3HwxxVCAGrH4hqUVtbjdTZXi1pjho0'

# —Å–ª–æ–≤–∞—Ä—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫–≤–µ—Å—Ç–∞ –∫–∞–∂–¥—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
user_stage = {}

# –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∫–≤–µ—Å—Ç–∞
correct_answer_1 = ['–¥–∂–æ–Ω—Å', '–Ω—É—Ä–º–∞–≥–æ–º–µ–¥–æ–≤', '–º–∞—Ö–∞—á–µ–≤', '–∫–∞–¥—ã—Ä–æ–≤']
correct_answer_2 = ['–∞–±–∞–π', '–∞–±–∞–π –∫—É–Ω–∞–Ω–±–∞–µ–≤', '–∞–±–∞–π “õ“±–Ω–∞–Ω–±–∞–µ–≤', '“õ“±–Ω–∞–Ω–±–∞–µ–≤', '–∫—É–Ω–∞–Ω–±–∞–µ–≤']
correct_answer_3 = ['–ª—é–±–∏–º—ã–π']
correct_answer_4 = ['120000']
correct_answer_5 = ['13']
correct_answer_6 = ['11']
correct_answer_7 = ['—Ç–æ–º–∞—Å', '—Ç–æ–º–∞—Å —à–µ–ª–±–∏', '—à–µ–ª–±–∏ —Ç–æ–º–∞—Å']
correct_answer_8 = ['—Å–∞–ø–∞—Ä', 'sapar', '–¥–∞—Ä—Ö–∞–Ω –¥–∂—É–∑–∑ - —Å–∞–ø–∞—Ä', '–¥–∞—Ä—Ö–∞–Ω –¥–∂—É–∑ - —Å–∞–ø–∞—Ä']


# —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    user_stage[user_id] = 1
    await update.message.reply_text(
        "—è –ø–æ—à—É—Ç–∏–≤, –ø–∏—à–∏ /quest, –∏ —Ç–æ–≥–¥–∞ —Ç–æ—á–Ω–æ –≤—Å—ë –Ω–∞—á–Ω—ë—Ç—Å—è —ã—ã—ã"
    )

# –∑–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–≥–æ –∫–≤–µ—Å—Ç–∞
async def quest(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    user_stage[user_id] = 2
    await update.message.reply_text(
        "–∫–≤–µ—Å—Ç 1\n\n"
        "–Ω–∞—á–Ω–µ–º —Å —Ç–æ–≥–æ, –≤ —á–µ–º —Ç—ã –æ–¥–∏–Ω –∏–∑ –ª—É—á—à–∏—Ö.. "
        "–æ–∫—Ç–∞–≥–æ–Ω, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, —Å–∏–ª–∞ ‚Äî —ç—Ç–æ —Ç–≤–æ—ë!\n\n"
        "–≤–æ–ø—Ä–æ—Å: –∫–æ–≥–æ —Ç—ã –±—ã –Ω–∞–∑–≤–∞–ª –≤–µ–ª–∏—á–∞–π—à–∏–º –±–æ–π—Ü–æ–º –≤ –∏—Å—Ç–æ—Ä–∏–∏ ufc?\n\n"
        "–Ω–∞–ø–∏—à–∏ —Ç–æ–ª—å–∫–æ —Ñ–∞–º–∏–ª–∏—é."
    )

# –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    text = update.message.text.strip().lower()
    stage = user_stage.get(user_id, 0)

    # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–µ—Å—Ç–∞ 1
    if stage == 2:
        if text in correct_answer_1:
            user_stage[user_id] = 3
            await update.message.reply_text(
                "–≤–µ—Ä–Ω–æ. —Ç—ã –∑–Ω–∞–µ—à—å —Å–≤–æ–µ –¥–µ–ª–æ!! <3\n"
                "–¥–µ—Ä–∂–∏ ‚Äî *–ª—ã*.\n"
                "–∑–∞–ø–æ–º–∏–Ω–∞–π, —ç—Ç–æ —Ç–µ–±–µ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è.\n\n"
                "–≥–æ—Ç–æ–≤ –∫–æ –≤—Ç–æ—Ä–æ–º—É –∫–≤–µ—Å—Ç—É? –ø–∏—à–∏ /next"
            )
        else:
            await update.message.reply_text(
                "–Ω–µ —Å–æ–≤—Å–µ–º...\n"
                "–¥–∞–≤–∞–π –ø–æ–ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑?\n"
                "–≤—Å–ø–æ–º–Ω–∏: —ç—Ç–æ –∏–º—è –≥—Ä–µ–º–∏—Ç –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É! "
                "–∏ —Ç—ã —Å–∞–º –∫–æ–≥–¥–∞-—Ç–æ –º–Ω–µ –æ –Ω–µ–º —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–ª."
            )
    # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–µ—Å—Ç–∞ 2
    elif stage == 4:
        if text in correct_answer_2:
            user_stage[user_id] = 5
            await update.message.reply_text(
                "–¥”ô–ª —Ç–∞–ø—Ç—ã“£ ‚ù§Ô∏è\n\n"
                "*–µ*\n"
                "–∂–∞–∑—ã–ø –∞–ª. –∞–ª–¥–∞ —Ç–∞“ì—ã –±–∞—Ä.\n\n"
                "–∫–µ–∑–µ–∫—Ç—ñ –∫–≤–µ—Å—Ç–∫–µ –∫”©—à—É “Ø—à—ñ–Ω /next –¥–µ–ø –∂–∞–∑"
            )
        else:
            await update.message.reply_text(
                "–¥–∞–≤–∞–π –¥—É–º–∞–π —Ç–∞“ì—ã. —Å–µ–Ω –æ–Ω—ã –±—ñ–ª–µ—Å—ñ“£.\n"
                "—Å”©–∑–¥–µ—Ä—ñ –∂“Ø—Ä–µ–∫–∫–µ —Å”©–π–ª–µ–π–¥—ñ."
            )

    # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–µ—Å—Ç–∞ 3
    elif stage == 6:
        if text in correct_answer_3:
            user_stage[user_id] = 7
            await update.message.reply_text(
                "—ç—Ç–æ—Ç –ø–æ—Å—Ç ‚Äî –ø—Ä–æ —Ç–µ–±—è –∏ –º–µ–Ω—è –≤–º–µ—Å—Ç–µ. –ì–ª—è–Ω—å –Ω–∞ —Ñ–æ—Ç–∫–∏, –∫–∞–∫–∞—è —è –¥–æ–≤–æ–ª—å–Ω–∞—è?\n\n"
                "–∑–∞–ø–æ–º–∏–Ω–∞–π ‚Äî *–Ω—ã*\n"
                "–∏ –ø–∏—à–∏ /next, —á—Ç–æ–±—ã –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ."
            )
        else:
            await update.message.reply_text(
                "–∞ –Ω—É —Å–º–æ—Ç—Ä–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ!\n"
                "–æ–¥–Ω–æ —Å–ª–æ–≤–æ, –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ–µ."
            )

    # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–µ—Å—Ç–∞ 4
    elif stage == 8:
        if text in correct_answer_4:
            user_stage[user_id] = 9
            await update.message.reply_text(
                "—Ç–∞–∫ —Ç–æ—á–Ω–æ —ã—Ö–≤—Ö—ã–≤—Ö–≤—ã—Ö\n"
                "–Ω—É –ª–∞–¥–Ω–æ, –∫–∞–∫-—Ç–æ —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ, –¥–∞? –£—Å–ª–æ–∂–Ω—è–µ–º –∑–∞–¥–∞–Ω–∏–µ!\n\n"
                "–∞, —á—É—Ç—å –Ω–µ –∑–∞–±—ã–ª–∞ ‚Äî *—Ç–∞–ª*\n"
                "–∑–∞–ø–æ–º–Ω–∏–ª? —Ç–µ–ø–µ—Ä—å –ø–∏—à–∏ /next, —á—Ç–æ–±—ã –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ."
            )
        else:
            await update.message.reply_text(
                "–º–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —Ç—ã –Ω–µ —Ç—É —Ü–∏—Ñ—Ä—É –ø–æ—Å–º–æ—Ç—Ä–µ–ª —ã—Ö–≤–∑—Ö–∞—Ñ–∑—Ö—ã–≤\n"
                "–≤–≤–µ–¥–∏ —Ç–æ—á–Ω—É—é —Ü–µ–Ω—É –≤ —Ç–µ–Ω–≥–µ, –∫–∞–∫ –Ω–∞ —Å–∞–π—Ç–µ!!!"
            )

    # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–µ—Å—Ç–∞ 5
    elif stage == 10:
        if text in correct_answer_5:
            user_stage[user_id] = 11
            await update.message.reply_text(
                "–∏–Ω–∂–µ–Ω–µ—Ä—ñ–º —ã–≤—Ö–∑—Ñ–∞—Ö–∑—Ñ—ã—Ö–∑\n"
                "–≤—Å—ë –ø–æ –¥–µ–ª—É, –≤—Å—ë —Ç–æ—á–Ω–æ! –≤–æ—Ç –∏ —Ç–µ–±–µ –ø–æ –¥–µ–ª—É –¥–≤–µ –±—É–∫–æ–≤–∫–∏ ‚Äî *–ø–µ*\n\n"
                "–≤–ø–µ—Ä—ë–¥? —Ç–æ–≥–¥–∞ –ø–∏—à–∏ /next"
            )
        else:
            await update.message.reply_text(
                "–Ω–µ —Å–æ–≤—Å–µ–º. –≤—Å–ø–æ–º–Ω–∏ —Ç–∞–±–ª–∏—Ü—É –º–µ–Ω–¥–µ–ª–µ–µ–≤–∞..."
            )

    # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–µ—Å—Ç–∞ 6
    elif stage == 12:
        if text in correct_answer_6:
            user_stage[user_id] = 13
            await update.message.reply_text(
                "–Ω—É –ø—Ä–æ—Å—Ç–∞ –∫–æ—Ä–æ–ª—å –ª–æ–≥–∞—Ä–∏—Ñ–º–æ–≤\n"
                "–ø—Ä–æ—Å—Ç–∞ —Å–∞–º–∞—è –≤—ã—à–∫–∞. –µ—â–µ –¥–≤–µ –±—É–∫–æ–≤–∫–∏ ‚Äî *–º–µ*\n\n"
                "–º—ã –ø–æ—á—Ç–∏ —É —Ñ–∏–Ω–∞–ª–∞! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º? –ø–∏—à–∏ /next"
            )
        else:
            await update.message.reply_text(
                "—á—Ç–æ-—Ç–æ –Ω–µ —Å—Ö–æ–¥–∏—Ç—Å—è... –º–∏–∫–æ –∞“ì–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –ª–æ–≥–∞—Ä–∏—Ñ–º–æ–≤ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞!"
            )

    # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–µ—Å—Ç–∞ 7
    elif stage == 14:
        if text in correct_answer_7:
            user_stage[user_id] = 15
            await update.message.reply_text(
                "–≤ —Ç–æ—á–∫—É! –≤–æ—Ç –æ–Ω —Å–∏–ª—å–Ω—ã–π –∏ –º–æ–ª—á–∞–ª–∏–≤—ã–π –∏ –æ —Å–µ–º—å–∏ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–∏ –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç  \n"
                "–∫–∞–∫ —Ç—ã —Ö—ã—Ö—ã—Ö—Ö—ã\n\n"
                "–∑–∞–ø–æ–º–∏–Ω–∞–µ–º *—Ä–µ*, –ø–∏—à–µ–º /next, –∏ –¥–≤–∏–Ω–µ–º—Å—è –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∫–≤–µ—Å—Ç–∏–∫—É."
            )
        else:
            await update.message.reply_text(
                "–≤—Å–ø–æ–º–Ω–∏, –∫—Ç–æ –º–æ–≥ —Å–∫–∞–∑–∞—Ç—å —ç—Ç–æ.  \n"
                "—Ç—ã —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—à—å –µ–≥–æ."
            )
    # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–µ—Å—Ç–∞ 8
    elif stage == 16:
        if text in correct_answer_8:
            user_stage[user_id] = 17
            await update.message.reply_text(
                "—Ö–∏—Ö–∏—Ö–∏—Ö–∏\n"
                "–æ–Ω–∞! —Ç—ã –µ–π –æ—Ç–∫—Ä—ã–ª –º–Ω–µ –º–∏—Ä –∫–∞–∑–∞—Ö—Å–∫–∏—Ö –ø–µ—Å–µ–Ω, –∑–Ω–∞–µ—à—å –∂–µ, –¥–∞?\n\n"
                "–ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–ª—é—á ‚Äî *—Ö–æ–¥*\n"
                "—Ç–µ–ø–µ—Ä—å —É —Ç–µ–±—è –µ—Å—Ç—å –≤—Å–µ —á–∞—Å—Ç–∏ –∫ –æ—Ç–≤–µ—Ç—É... –Ω–æ —á—Ç–æ —ç—Ç–æ –±—ã–ª–∏ –∑–∞ –±—É–∫–æ–≤–∫–∏ —Ä–∞–Ω–¥–æ–º–Ω—ã–µ?\n\n"
                "–ø–∏—à–∏ /final, —á—Ç–æ–±—ã –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–∞–∑–≥–∞–¥–∫–µ!"
            )
        else:
            await update.message.reply_text(
                "–ø–æ—á—Ç–∏. –≤—Å–ø–æ–º–Ω–∏, —ç—Ç–æ –±—ã–ª–∞ –ø–µ—Ä–≤–∞—è –ø–µ—Å–Ω—è, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –º–Ω–µ –≤–∫–ª—é—á–∏–ª –æ—Ç –Ω–µ–≥–æ."
            )

    # –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ñ—Ä–∞–∑—ã
    elif stage == 18:
        if text.replace(" ", "").lower() in ['–ø–µ—Ä–µ—Ö–æ–¥–Ω—ã–µ–º–µ—Ç–∞–ª–ª—ã']:
            user_stage[user_id] = 19
            await update.message.reply_text(
                "—Ç–æ—á–Ω–æ! —Ç—ã —Å–æ–±—Ä–∞–ª –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ üß©\n\n"
                "—Ñ—É—Ö, –Ω–∞–∫–æ–Ω–µ—Ü –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥?\n"
                "–ø–æ–º–Ω–∏—à—å –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã–µ –º–µ—Ç–∞–ª–ª—ã –≤ —Ç–∞–±–ª–∏—Ü–µ –ú–µ–Ω–¥–µ–ª–µ–µ–≤–∞? –∑–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —Å–ª–æ–≤–æ - –∫–∞–∫ —Ä–∞–∑ —Ç–∞–∫–∏ –æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö –º–µ—Ç–∞–ª–ª–æ–≤!\n\n"
                "–Ω–∞–ø–∏—à–∏ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏–µ. —Ö–∏–Ω—Ç - —Ç—ã –∏ –µ—Å—Ç—å –∫–ª—é—á –∫ —Ä–∞–∑–≥–∞–¥–∫–µ!"
            )
        else:
            await update.message.reply_text(
                "—á—Ç–æ-—Ç–æ –Ω–µ —Å—Ö–æ–¥–∏—Ç—Å—è. –ø–æ–ø—Ä–æ–±—É–π –ø–µ—Ä–µ—Å—Ç–∞–≤–∏—Ç—å —Å–ª–æ–≥–∏ –∏ —Å–æ—Å—Ç–∞–≤–∏—Ç—å 2 —Å–ª–æ–≤–∞."
            )

    # —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
    elif stage == 19:
        if text.lower() in ['–±–æ—Ä–∏–π', 'bohrium']:
            user_stage[user_id] = 20
            await update.message.reply_text(
                "–¥–∞!! —ç—Ç–æ *–±–æ—Ä–∏–π*, —ç–ª–µ–º–µ–Ω—Ç ‚Ññ107 üß™\n\n"
                "—Ç—ã —Å–∞–º, –∫–∞–∫ —ç–ª–µ–º–µ–Ω—Ç: —Ä–µ–¥–∫–∏–π, —Å–∏–ª—å–Ω—ã–π, –∏ –Ω–µ–∑–∞–º–µ–Ω–∏–º—ã–π.\n\n"
                "–Ω—É —Ç—É—Ç —É–∂–µ —è –ø–µ—Ä–µ–¥–∞—é —Å–ª–æ–≤–æ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –≥–æ—Å–ø–æ–∂–µ –ú–∞–º—Ä–∞—Ç–æ–≤–æ–π!\n"
                "–µ—â–µ —Ä–∞–∑ —Å –¥–Ω—ë–º –∑–∞—â–∏—Ç–Ω–∏–∫–∞ –æ—Ç–µ—á–µ—Å—Ç–≤–∞, –º–æ–π –≥–µ—Ä–æ–π ‚ù§Ô∏è"
            )
        else:
            await update.message.reply_text(
                "–ø–æ—á—Ç–∏. –ø–æ–¥—É–º–∞–π –æ —Å–≤–æ–µ–º –¥–Ω–µ —Ä–æ–∂–¥–µ–Ω–∏—è!"
            )


    else:
        await update.message.reply_text("–Ω–∞–ø–∏—à–∏ /quest —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ")

# –∑–∞–ø—É—Å–∫ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–≤–µ—Å—Ç–æ–≤ –ø–æ –æ—á–µ—Ä–µ–¥–∏
async def next_step(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    stage = user_stage.get(user_id, 0)

    if stage == 3:
        # –∫–≤–µ—Å—Ç 2
        user_stage[user_id] = 4
        await update.message.reply_text(
            "–∫–≤–µ—Å—Ç 2!\n\n"
            "—Å–µ–Ω—ñ“£ “õ–∞–∑–∞“õ –º”ô–¥–µ–Ω–∏–µ—Ç—ñ–º–µ–Ω “õ–∞—Ç—ã–Ω–∞—Å—ã ”ô—Ä“õ–∞—à–∞–Ω –±–∞“ì–∞–ª–∞–π—Ç—ã–Ω–º—ã–Ω -\n"
            "–∂–∞–π “ì–∞–Ω–∞ –±—ñ–ª–µ –∞–ª–º–∞–π—Å—ã“£ ‚Äî —Å–µ–∑—ñ–Ω—É –∫–µ—Ä–µ–∫—Ç—ñ–≥—ñ–Ω –±—ñ–ª–µ—Å—ñ“£!\n"
            "–æ—Å—ã —Ç–µ—Ä–µ“£–¥—ñ–≥—ñ“£ ‚Äî —Å–µ–Ω—ñ“£ –∫“Ø—à—ñ“£.\n\n"
            "–±—ñ—Ä –∞“õ—ã–Ω—ã:\n"
            "¬´–ê–ª–ª–∞–Ω—ã“£ ”©–∑—ñ –¥–µ —Ä–∞—Å, —Å”©–∑—ñ –¥–µ —Ä–∞—Å,\n"
            "–†–∞—Å —Å”©–∑ –µ—à—É–∞“õ—ã—Ç—Ç–∞ –∂–∞–ª“ì–∞–Ω –±–æ–ª–º–∞—Å.¬ª ‚Äî –¥–µ–ø –∂–∞–∑–¥—ã.\n\n"
            "–æ–Ω—ã“£ –∞—Ç—ã –∫—ñ–º –±–æ–ª–¥—ã? (—Ç–æ–ª—å–∫–∞ –∑–∞ –∞—à–∏–ø–∫–∏ –Ω–µ –±–µ–π...)\n"
        )

    elif stage == 5:
        # –∫–≤–µ—Å—Ç 3
        user_stage[user_id] = 6
        await update.message.reply_text(
            "–∫–≤–µ—Å—Ç 3!\n\n"
            "–∏–Ω–æ–≥–¥–∞ –≤–∞–∂–Ω—ã–µ –≤–µ—â–∏ —Å–ø—Ä—è—Ç–∞–Ω—ã –Ω–∞ –≤–∏–¥—É.  \n"
            "–∏–Ω–æ–≥–¥–∞ ‚Äî –≤ —Å—Ç–æ—Ä–∏—Å.  \n"
            "–∞ –∏–Ω–æ–≥–¥–∞ ‚Äî –≤ –º–æ–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∫ —Ç–µ–±–µ.\n\n"
            "—è —á–∞—Å—Ç–æ –≥–æ–≤–æ—Ä—é —Ç–µ–±–µ, —á—Ç–æ —Ç—ã –¥–ª—è –º–µ–Ω—è –Ω–µ –ø—Ä–æ—Å—Ç–æ —á–µ–ª–æ–≤–µ–∫.  \n"
            "–Ω–∞–π–¥–∏ –ø–æ—Å—Ç –≤ –∏–Ω—Å—Ç–∞–≥—Ä–∞–º–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –±—ã–ª–∏ —Å–¥–µ–ª–∞–Ω—ã —Ç–æ–±–æ–π. –∫–∞–∫ —è –Ω–∞–∑–≤–∞–ª–∞ —Ç–µ–±—è –≤ —ç—Ç–æ–º –ø–æ—Å—Ç–µ?\n\n"
            "–Ω–∞–ø–∏—à–∏ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–ª–æ–≤–æ."
        )

    elif stage == 7:
        # –∫–≤–µ—Å—Ç 4
        user_stage[user_id] = 8
        await update.message.reply_text(
            "–∫–≤–µ—Å—Ç 4.\n\n"
            "–≤ —Ç–µ–±–µ –µ—Å—Ç—å –æ—Å–æ–±—ã–π —Å—Ç–∏–ª—å.  \n"
            "–Ω–µ –ø–æ–∫–∞–∑–Ω–æ–π, –∞ —É–≤–µ—Ä–µ–Ω–Ω—ã–π.  \n"
            "—Ç—ã –Ω–µ —Å–ª–µ–¥—É–µ—à—å —Ç—Ä–µ–Ω–¥–∞–º ‚Äî —Ç—ã –∑–∞–¥–∞—ë—à—å —Ä–∏—Ç–º.  \n"
            "–∏ —è –≤—Å–µ–≥–¥–∞ —ç—Ç–æ –∑–∞–º–µ—á–∞—é.\n\n"
            "–≤–æ–ø—Ä–æ—Å:  \n"
            "–∑–∞–π–¥–∏ –Ω–∞ —Å–∞–π—Ç massimo dutti.  \n"
            "–Ω–∞–π–¥–∏, —Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç —Å–∞–º–æ–µ –¥–æ—Ä–æ–≥–æ–µ –ø–æ–ª–æ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–µ–π—á–∞—Å.\n\n"
            "–≤–≤–µ–¥–∏ —Ü–µ–Ω—É –≤ —Ç–µ–Ω–≥–µ!"
        )

    elif stage == 9:
        # –∫–≤–µ—Å—Ç 5
        user_stage[user_id] = 10
        await update.message.reply_text(
            "–∫–≤–µ—Å—Ç 5 ‚Äì\n\n"
            "—Ç—ã –≤—Å–µ–≥–¥–∞ –≤–æ—Å—Ö–∏—â–∞–ª –º–µ–Ω—è —Ç–µ–º, –∫–∞–∫ —Ä–∞–∑–±–∏—Ä–∞–µ—à—å—Å—è –≤ —Å–ª–æ–∂–Ω—ã—Ö –≤–µ—â–∞—Ö.  \n"
            "—Ç–æ, —á—Ç–æ –ø—É–≥–∞–µ—Ç –¥—Ä—É–≥–∏—Ö, —Ç–µ–±–µ –¥–∞—ë—Ç –∞–∑–∞—Ä—Ç. —Ç—ã ‚Äî –∫–∞–∫ –∏–Ω–∂–µ–Ω–µ—Ä –¥–ª—è –∂–∏–∑–Ω–∏!\n\n"
            "—Ç–∞–∫ –≤–æ—Ç, –≤–æ–ø—Ä–æ—Å –¥–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–∞:  \n"
            "–∫–∞–∫–æ–π –º–µ—Ç–∞–ª–ª —á–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∞–≤–∏–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏ –∏–∑-–∑–∞ —Å–≤–æ–µ–π –ª—ë–≥–∫–æ—Å—Ç–∏ –∏ –ø—Ä–æ—á–Ω–æ—Å—Ç–∏?\n"
            "–ø—Ä–æ–≤–µ—Ä–û—á–∫–∞! (–¥–∞–¥–∞ —è —à—É—Ç–Ω–∏—Ü–∞)\n\n"
            "–≤–≤–µ–¥–∏ –∞—Ç–æ–º–Ω—ã–π –Ω–æ–º–µ—Ä —ç—Ç–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞."
        )

    elif stage == 11:
        # –∫–≤–µ—Å—Ç 6
        user_stage[user_id] = 12
        await update.message.reply_text(
            "–∫–≤–µ—Å—Ç 6.\n\n"
            "–∏–Ω–æ–≥–¥–∞ —è –¥—É–º–∞—é ‚Äî —É —Ç–µ–±—è –≤ –≥–æ–ª–æ–≤–µ –≥—Ä–∞—Ñ–∏–∫–∏, —Ñ–æ—Ä–º—É–ª—ã –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ. –∫–æ–Ω–µ—á–Ω–æ, –ø–æ—Ä–æ–π —Ç—ã —Å–∞–º —Å–µ–±–µ –∂–∏–∑–Ω—å —É—Å–ª–æ–∂–Ω—è–µ—à—å, –Ω–æ —Ç—ã –±—É–¥—Ç–æ —Å–æ–∑–¥–∞–Ω, —á—Ç–æ–±—ã —Ä–µ—à–∞—Ç—å —Ç–æ, —á—Ç–æ –Ω–µ –≤—Å–µ–º –ø–æ –∑—É–±–∞–º.\n"
            "—Ç–æ—á–Ω—ã–π –∏ –º–æ—â–Ω—ã–π.  \n"
            "—è –∑–Ω–∞—é, —Ç—ã —ç—Ç–æ —Ä–µ—à–∏—à—å –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º —É—Å–ø–µ–µ—à—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å.. –¥–∞?\n\n"
            "log‚ÇÇ(2‚Åµ) + log‚ÇÉ(‚àö81) + log‚ÇÅ‚ÇÄ(10‚Å¥) = ?\n\n"
        )

    elif stage == 13:
        # –∫–≤–µ—Å—Ç 7
        user_stage[user_id] = 14
        await update.message.reply_text(
            "–∫–≤–µ—Å—Ç 7:\n\n"
            "—Ç—ã –º–æ–π –≥–µ—Ä–æ–π.  \n"
            "–∏ –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–∏–∞–ª–µ –µ—Å—Ç—å —Å–≤–æ–π!\n\n"
            "–¥–∞–≤–∞–π –≤—Å–ø–æ–º–Ω–∏–º –æ–¥–∏–Ω –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–π —Å–µ—Ä–∏–∞–ª,  \n"
            "–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —è, –∫–æ–Ω–µ—á–Ω–æ, –≥–æ–≤–æ—Ä–∏—Ç—å –Ω–µ –±—É–¥—É —ã–≤—Ö—ã—Ö–≤—Ö—ã–≤—Ö—ã–≤\n\n"
            "–≤–æ–ø—Ä–æ—Å:  \n"
            "–∫—Ç–æ —Å–∫–∞–∑–∞–ª:\n"
            "‚Äúyou can change what you do, but you can‚Äôt change what you want.‚Äù\n\n"
            "–Ω–∞–ø–∏—à–∏ –∏–º—è –≥–µ—Ä–æ—è."
        )

    elif stage == 15:
        # –∫–≤–µ—Å—Ç 8
        user_stage[user_id] = 16
        await update.message.reply_text(
            "–∫–≤–µ—Å—Ç 8.\n\n"
            "—Ç—ã —Ö–æ—Ä–æ—à–æ –ø–æ–º–Ω–∏—à—å –¥–µ—Ç–∞–ª–∏.  \n"
            "–∏ –æ—Å–æ–±–µ–Ω–Ω–æ ‚Äî —Ç–µ, —á—Ç–æ —Å–≤—è–∑–∞–Ω—ã —Å –Ω–∞–º–∏.\n\n"
            "–∞ –ø–æ–º–Ω–∏—à—å, –∫–∞–∫–æ–π –ø–µ—Å–Ω–µ–π —Ç—ã –º–µ–Ω—è –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª —Å –î–∞—Ä—Ö–∞–Ω–æ–º –î–∂—É–∑–∑?\n\n"
            "–Ω–∞–ø–∏—à–∏ –µ—ë –Ω–∞–∑–≤–∞–Ω–∏–µ."
        )

    else:
        await update.message.reply_text("—Ç–∞–∫, –≤—Å–µ –ø–æ –ø–æ—Ä—è–¥–∫—É! –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ –≤–æ–ø—Ä–æ—Å–∏–∫–∏–∏–∏")

# —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥
async def final_step(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    stage = user_stage.get(user_id, 0)

    if stage == 17:
        user_stage[user_id] = 18
        await update.message.reply_text(
            "—Ñ–∏–Ω–∞–ª! —É—Ä–∞-—É—Ä–∞!\n\n"
            "—Ç–∞–∫ –≤–æ—Ç, —ç—Ç–∏ –±—É–∫–æ–≤–∫–∏ –±—ã–ª–∏ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Å–ª–æ–≥–∞–º–∏ –æ–¥–Ω–æ–≥–æ —Å–ª–æ–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è. —É —Ç–µ–±—è –µ—Å—Ç—å 8 —Å–ª–æ–≥–æ–≤:\n"
            "*–ª—ã, –º–µ, –Ω—ã, —Ö–æ–¥, –ø–µ, –µ, —Ä–µ, —Ç–∞–ª* (—è –≥–æ–≤–æ—Ä–∏–ª–∞ –∑–∞–ø–æ–º–Ω–∏—Ç—å, –Ω–æ —Ç–∞–∫ –∫–∞–∫ —Å–µ–≥–æ–¥–Ω—è —Ç–≤–æ–π –ø—Ä–∞–∑–¥–Ω–∏–∫, —è –æ–±–ª–µ–≥—á—É —Ç–µ–±–µ –∑–∞–¥–∞—á—É)\n\n"
            "—Ç–µ–ø–µ—Ä—å —Å–æ–±–µ—Ä–∏ –∏–∑ –Ω–∏—Ö —Ñ—Ä–∞–∑—É.\n"
            "–≤–ø–∏—à–∏ –µ—ë –ø–æ–ª–Ω–æ—Å—Ç—å—é (2 —Å–ª–æ–≤–∞).\n"
            "–µ—Å–ª–∏ –≤—Å—ë –≤–µ—Ä–Ω–æ ‚Äî –ø–æ–ª—É—á–∏—à—å –ø–æ—Å–ª–µ–¥–Ω—é—é (—á–µ—Å—Ç–Ω–æ!) –ø–æ–¥—Å–∫–∞–∑–∫—É."
        )
    elif stage > 17:
        await update.message.reply_text("—Ç—ã —É–∂–µ –ø—Ä–æ—à—ë–ª —ç—Ç—É —á–∞—Å—Ç—å ‚Äî –ø—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏ —Å–æ–±—Ä–∞–Ω–Ω—É—é —Ñ—Ä–∞–∑—É!")
    else:
        await update.message.reply_text("—Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–π–¥–∏ –≤—Å–µ –∫–≤–µ—Å—Ç—ã –∏ —Å–æ–±–µ—Ä–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏, —á–∏—Ç–µ—Ä")

# –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
if __name__ == '__main__':
    app = ApplicationBuilder().token(TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("quest", quest))
    app.add_handler(CommandHandler("next", next_step))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    app.add_handler(CommandHandler("final", final_step))

    print("–±–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    app.run_polling()
